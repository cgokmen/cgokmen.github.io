---
layout: post
title: Random & Unique String Generation Using MySQL
date: 2013-11-06 00:05:06.000000000 -05:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Programming
- Technology
tags:
- Lua
- MTA
- MySQL
meta:
  _edit_last: '1'
  _syntaxhighlighter_encoded: '1'
  _wpas_done_all: '1'
author:
  login: Funstein
  email: cem@cemgokmen.com
  display_name: Cem Gokmen
  first_name: Cem
  last_name: Gokmen
---
<p>Good evening,</p>
<p>I'm back with the first ever informative blog post!</p>
<p>So recently I had rewritten this vehicles script for our Multi Theft Auto server WhySoSerious:RPG. The script was a static vehicles script that read data off of a MySQL Table. What the new version did was it would assign a unique license plate to each newly generated vehicle. However, the problem with this script was that it used Lua to generate the strings and query the vehicles' MySQL table one by one for each generated string, which lagged the server and increased the required number of queries we needed to do before INSERTing the new vehicle into the database.</p>
<p>So I came up with a MySQL function that would generate a 8-char string and check if it already existed in the table, as many times as needed until a previously unused string is found. Then the function would simply return the found value, which would allow the function to be used within other queries.</p>
<p>Here's the function code:<br />
[sql]</p>
<p>DELIMITER $$<br />
CREATE FUNCTION GenerateLicensePlate()<br />
	RETURNS VARCHAR(8)</p>
<p>	BEGIN<br />
	DECLARE plate VARCHAR(8) DEFAULT &quot;&quot; ;<br />
	WHILE LENGTH(plate) = 0 DO<br />
		SELECT concat(substring('ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789', rand()*36+1, 1),<br />
      	        substring('ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789', rand()*36+1, 1),<br />
      	        substring('ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789', rand()*36+1, 1),<br />
            	substring('ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789', rand()*36+1, 1),<br />
             	substring('ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789', rand()*36+1, 1),<br />
             	substring('ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789', rand()*36+1, 1),<br />
              	substring('ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789', rand()*36+1, 1),<br />
              	substring('ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789', rand()*36+1, 1)<br />
             	) into @newplate;</p>
<p>  		SET @rcount = -1;<br />
  		SELECT COUNT(*) INTO @rcount FROM `vehicles` WHERE `plate` = @newplate ;</p>
<p>   		IF @rcount = 0 THEN<br />
   			SET plate = @newplate ;<br />
   		END IF ;<br />
	END WHILE ;</p>
<p>	RETURN plate ;<br />
	END$$<br />
DELIMITER ;</p>
<p>[/sql]</p>
<p>I used <a href="http://stackoverflow.com/a/16738136/1333566" target="_blank">this</a> response I got on a previous StackOverflow question I posted about it, and came up with the rest myself. Turns out those MySQL manuals are actually pretty handy when you try to read them.</p>
<p>You can read a random plate by using this query:<br />
[sql]</p>
<p>SELECT GenerateLicensePlate();</p>
<p>[/sql]</p>
<p>And you can implement it within your insert like this:<br />
[sql]</p>
<p>INSERT INTO `vehicles`(`name`, `plate`) VALUES (&quot;Coolcar&quot;, GenerateLicensePlate());</p>
<p>[/sql]</p>
<p>I hope it's useful, comment for any questions!</p>
